# [P1115 最大子段和](https://www.luogu.com.cn/problem/P1115)

首先，我们现在纸上手算一下样例是怎么来的：

```
2 -4 3 -1 2 -4 3
ans:4
```

可以发现选 `3 -1 2` 是一种合法的方案。那么是怎么推出来的呢？

首先看到第一个数，是 2。而 2 后面是 -4，所以如果 -4 是答案的一部分，那么 2 一定也要加上去（这样答案就增加了，会比原来优）。

随后是 3。如果 3 把前面的 2 和 -4 加上去，结果是 1。这个时候反而比原来的单独一个 3 要小。所以如果答案含有 3，就一定不会加上前面的 2 和 -4（加上前面的部分答案变小，不如到这里为止）。

下一个数是 -1。这个数加上前面的 3 之后答案增加了（变成了 2），所以如果答案有 -1，辣么绝对还有前面的 3。

接下来是 2，如果 2 加上前面的序列 (3,-1)，辣么它的值变为 4。比原先增加了。

然后是 -4，如果把 -4 加上前面的序列 (3,-1,2)，结果会变成 0，比原先的 -4 大，所以如果 -4 是答案的一部分，那么前面的三个数也一定是答案的一部分。

最后一个数 3，如果将 3 加上前面的序列，结果变成了 3，没有变，所以这个可加可不加。

最后我们来看一看刚推导的结果，发现 4 是我们可以得出的最大和。

所以说了这么多，最终的结果是什么呢？

- 第一个数为一个有效序列
- 如果一个数加上上一个有效序列得到的结果比这个数大，那么该数也属于这个有效序列。
- 如果一个数加上上一个有效序列得到的结果比这个数小，那么这个数单独成为一个新的有效序列
- 在执行上述处理的过程中实时更新当前有效序列的所有元素之和并取最大值。

然后就可能有人问了：考虑上面样例推导中，出现了一个可加可不加的 3。如何处理？

结论是：对于可加可不加的数，不如加上。因为加上对答案没有坏处，而如果这个数后面还有一部分能让答案变多，因为本题求的子段是连续子段，不加上的话这两边就连不起来了。所以无脑加就行了。

最后取最大值即可。

https://www.luogu.com.cn/article/6zbw4hi6

# [P1719 最大加权矩形](https://www.luogu.com.cn/problem/P1719)

这道题最难处理的是它是一个二维矩阵，因此需要**压缩这个二维矩阵**

如果我们把一行看做一个数，这里看做三个数a,b,c,那么将这三个相邻数的进行不同的组合，将这个新的组合相加视为一个新的数，这就是进行压缩处理，例如a,b,c可以组合为{[a],[ab],[abc],[b],[bc],[c]}，而矩阵压缩也类似。

**第一次我们取第一行：**

-5 6 4

则其最大子序列和为10，max=10。

**第二次取第一二行：**

-5 6 4

1 -2 6

所以压缩后的一维数组为：

-4 4 10

则其最大子序列和为14，max=14。

**第三次取第一二三行：**

-5 6 4

1 -2 6

2 1 -3

所以压缩后的一维数组为：

-2 5 7

则其最大子序列和为12，max=14。

**第四次取第二行：**

1 -2 6

则其最大子序列和为6，max=14。

**第五次取第二三行：**

1 -2 6

2 1 -3

所以压缩后的一维数组为：

3 -1 3

则其最大子序列和为5，max=14。

**以此类推，其中每次求最大子序列就是靠[P1115 最大子段和](https://www.luogu.com.cn/problem/P1115)这道题的方法**

因此这道题时间复杂度为`O(n^3)`